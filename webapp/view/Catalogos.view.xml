<mvc:View
    controllerName="com.cat.sapfioricatalogs.controller.Catalogos"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns="sap.m"
    xmlns:table="sap.ui.table"
    xmlns:core="sap.ui.core"
    displayBlock="true">

    <Page
        id="page"
        title="Catálogos y Valores"
        showNavButton="false"
        showHeader="false">

        <content>
            <VBox class="sapUiSmallMargin">

                <!-- Toolbar con botones de acción -->
                <OverflowToolbar>
                    <Title text="Catálogos y Valores" level="H2" />
                    <ToolbarSpacer />
                    <Button
                        id="btnNewCatalog"
                        text="Nuevo Catálogo"
                        icon="sap-icon://add"
                        press=".onNewCatalogo"
                        type="Emphasized" />
                    <Button
                        id="btnNewValue"
                        text="Nuevo Valor"
                        icon="sap-icon://add-document"
                        press=".onNewValor"
                        enabled="{= ${view>/selectedLabel} !== null}" />
                    <Button
                        id="btnUpdate"
                        text="Modificar"
                        icon="sap-icon://edit"
                        press=".onUpdate"
                        enabled="{= ${view>/selectedLabel} !== null}" />
                    <Button
                        id="btnDelete"
                        text="Eliminar"
                        icon="sap-icon://delete"
                        press=".onDelete"
                        type="Reject"
                        enabled="{= ${view>/selectionCount} > 0}" />
                    <Button
                        id="btnSave"
                        text="Guardar Cambios"
                        icon="sap-icon://save"
                        press=".onSaveChanges"
                        type="Success" />
                    <Button
                        id="btnRefresh"
                        text="Actualizar"
                        icon="sap-icon://refresh"
                        press=".onRefresh" />
                </OverflowToolbar>
                <SearchField
                    id="searchField"
                    placeholder="Buscar etiqueta, descripción, colección o sección..."
                    liveChange=".onSearch"  
                    showSearchButton="true"
                    width="100%"
                    class="sapUiSmallMarginBottom" />

                <!-- Mensajes de estado -->
                <MessageStrip
                    id="messageStrip"
                    text="{view>/saveMessage}"
                    type="Success"
                    showIcon="true"
                    visible="{= ${view>/saveMessage} !== ''}" />

                <!-- TreeTable -->
                <table:TreeTable
                    id="treeTable"
                    width="100%"
                    rows="{
                        path: '/labels',
                        parameters: {
                            arrayNames: ['children']
                        }
                    }"
                    selectionMode="MultiToggle"
                    selectionBehavior="RowSelector"
                    ariaLabelledBy="title"
                    visibleRowCount="20"
                    minAutoRowCount="10"
                    rowSelectionChange=".onRowSelectionChange"
                    class="sapUiSizeCompact">
                    <table:columns>

                        <!-- Etiqueta/Valor -->
                        <table:Column width="100%" sortProperty="etiqueta" filterProperty="etiqueta">
                            <Label text="Etiqueta/Valor" />
                            <table:template>
                                <Text
                                    text="{= ${valor} || ${etiqueta} }"
                                    wrapping="false" />
                            </table:template>
                        </table:Column>

                        <!-- IDETIQUETA/IDVALOR -->
                        <table:Column width="180px" sortProperty="idetiqueta"
                            filterProperty="idetiqueta">
                            <Label text="ID Etiqueta/Valor" />
                            <table:template>
                                <Text
                                    text="{= ${idvalor} || ${idetiqueta} }"
                                    wrapping="false" />
                            </table:template>
                        </table:Column>

                        <!-- IDSOCIEDAD -->
                        <table:Column width="120px" sortProperty="idsociedad"
                            filterProperty="idsociedad">
                            <Label text="ID Sociedad" />
                            <table:template>
                                <Text text="{idsociedad}" wrapping="false" />
                            </table:template>
                        </table:Column>

                        <!-- VALOR PADRE -->
                        <table:Column width="130px" sortProperty="idvalorpa"
                            filterProperty="idvalorpa">
                            <Label text="Valor Padre" />
                            <table:template>
                                <Text text="{idvalorpa}" wrapping="false" />
                            </table:template>
                        </table:Column>

                        <!-- IDCEDI -->
                        <table:Column width="100px" sortProperty="idcedi" filterProperty="idcedi">
                            <Label text="ID CEDI" />
                            <table:template>
                                <Text text="{idcedi}" wrapping="false" />
                            </table:template>
                        </table:Column>

                        <!-- INDICE -->
                        <table:Column width="150px" sortProperty="indice" filterProperty="indice">
                            <Label text="Índice" />
                            <table:template>
                                <Text text="{indice}" wrapping="false" />
                            </table:template>
                        </table:Column>

                        <!-- COLECCION -->
                        <table:Column width="150px" sortProperty="coleccion"
                            filterProperty="coleccion">
                            <Label text="Colección" />
                            <table:template>
                                <Text text="{coleccion}" wrapping="false" />
                            </table:template>
                        </table:Column>

                        <!-- SECCION -->
                        <table:Column width="150px" sortProperty="seccion" filterProperty="seccion">
                            <Label text="Sección" />
                            <table:template>
                                <Text text="{seccion}" wrapping="false" />
                            </table:template>
                        </table:Column>

                        <!-- SECUENCIA -->
                        <table:Column width="100px" sortProperty="secuencia"
                            filterProperty="secuencia" hAlign="End">
                            <Label text="Secuencia" />
                            <table:template>
                                <Text text="{secuencia}" wrapping="false" />
                            </table:template>
                        </table:Column>

                        <!-- IMAGEN -->
                        <table:Column width="100px">
                            <Label text="Imagen" />
                            <table:template>
                                <Image
                                    src="{imagen}"
                                    width="40px"
                                    height="40px"
                                    visible="{= ${imagen} !== null &amp;&amp; ${imagen} !== ''}" />
                            </table:template>
                        </table:Column>

                        <!-- ROUTE -->
                        <table:Column width="200px" sortProperty="ruta" filterProperty="ruta">
                            <Label text="Ruta" />
                            <table:template>
                                <Text text="{ruta}" wrapping="false" />
                            </table:template>
                        </table:Column>

                        <!-- DESCRIPCION -->
                        <table:Column width="300px" sortProperty="descripcion"
                            filterProperty="descripcion">
                            <Label text="Descripción" />
                            <table:template>
                                <Text text="{descripcion}" wrapping="true" />
                            </table:template>
                        </table:Column>

                    </table:columns>

                </table:TreeTable>

            </VBox>
        </content>
    </Page>

</mvc:View>